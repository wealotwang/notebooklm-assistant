# NotebookLM 时间轴滚动条开发计划 (已确认 DOM 结构)

根据你提供的 DOM 结构截图，我们已经锁定了关键元素。我们将实现一个**独立于原生滚动条的右侧悬浮时间轴**，它不仅能显示进度，还能直观地标出所有“用户提问”的位置。

## 1. 核心选择器定义
我们将使用以下选择器来“钩住”页面的关键部分：

*   **滚动容器 (Scroll Container)**: `.chat-panel-content`
    *   这是负责滚动的区域，我们将监听它的 `scroll` 事件，并控制它的滚动位置。
*   **用户提问锚点 (User Anchors)**: `.from-user-container`
    *   这是每个用户提问的最外层容器。我们将遍历所有此类元素，在时间轴上生成对应的圆点。

## 2. 详细实施步骤

### Phase 1: 基础架构与样式注入
*   **目标**：在页面右侧渲染出一个静态的、灰色的时间轴轨道，并为原内容腾出空间。
*   **动作**：
    1.  创建 `src/pages/content/timeline/styles.css`: 定义时间轴、滑块、圆点的样式（参考 Voyager 的 CSS 变量布局方案）。
    2.  创建 `src/pages/content/timeline/manager.ts`: 编写初始化逻辑，将 HTML 结构注入到 `body` 中。
    3.  **关键样式调整**：给 `.chat-panel-content` 强制添加 `padding-right: 40px`，确保内容不被时间轴遮挡。

### Phase 2: 核心交互逻辑 (Manager.ts)
*   **目标**：让时间轴“动”起来，与页面滚动双向绑定。
*   **动作**：
    1.  **映射算法**：计算每个 `.from-user-container` 相对于 `.chat-panel-content` 总高度的百分比位置。
    2.  **渲染圆点**：根据计算出的百分比，在时间轴上放置 `.timeline-dot`。
    3.  **双向同步**：
        *   **滚动 -> 时间轴**：页面滚动时，实时更新右侧“滑块”的位置。
        *   **时间轴 -> 滚动**：点击圆点或拖动滑块时，计算目标 `scrollTop` 并平滑滚动页面。

### Phase 3: 动态监听 (MutationObserver)
*   **目标**：当有新对话产生时，时间轴能自动更新。
*   **动作**：
    1.  使用 `MutationObserver` 监听 `.chat-panel-content` 的子节点变化。
    2.  一旦检测到新消息上屏，触发防抖（Debounce）的重绘函数，重新计算并渲染最新的锚点。

### Phase 4: 细节打磨
*   **悬停效果**：鼠标悬停在圆点上时，高亮对应的 DOM 元素，甚至显示一个简单的 Tooltip（显示提问的前几个字）。
*   **视觉优化**：确保在深色/浅色模式下都能清晰可见（NotebookLM 似乎有深色模式，我们需要适配）。

---

**确认后，我将按照此计划从 Phase 1 开始编写代码。**