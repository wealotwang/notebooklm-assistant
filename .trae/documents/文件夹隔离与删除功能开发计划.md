# 文件夹隔离与删除功能开发计划

针对您提出的两个核心问题，我制定了以下解决方案：

## 1. 文件夹“笔记本隔离” (Notebook Isolation)
目前插件使用全局存储，导致所有笔记本共享同一套分类。我们将改为**基于笔记本 ID 的独立存储**。

*   **识别机制**: 从 URL (`/notebook/<id>`) 中提取唯一的 Notebook ID。
*   **存储策略**:
    *   旧模式: `nlm_folders`, `nlm_mappings` (全局共享)。
    *   新模式: `nlm_folders_<notebook_id>`, `nlm_mappings_<notebook_id>` (独立隔离)。
*   **平滑切换**:
    *   当您打开一个新笔记本时，插件会自动创建一个空的、独立的分类体系（仅包含“全部”）。
    *   我们会添加**路由监听**，确保在不刷新页面的情况下切换笔记本（SPA 跳转），插件也能自动重新加载对应的数据。

## 2. 文件夹删除功能 (Folder Deletion)
我们将为文件夹添加右键菜单，支持删除操作。

*   **交互设计**: 在文件夹胶囊（Chips）上**点击鼠标右键**。
*   **功能菜单**: 弹出“删除文件夹”选项。
*   **安全逻辑**:
    *   “全部”文件夹不可删除。
    *   删除文件夹后，会自动清理所有文件与该文件夹的关联（文件本身不会被删除，只是移出了该分类）。
    *   删除前会有二次确认弹窗。

## 3. 实施步骤

### Phase 1: 核心逻辑升级 (`content.js`)
1.  **增加 `getNotebookId()` 工具函数**: 解析当前 URL。
2.  **改造 `loadData/saveData`**: 动态拼接存储 Key，实现数据隔离。
3.  **增加路由监听**: 监听 URL 变化，一旦检测到 Notebook ID 变更，立即重置状态并重新加载数据。

### Phase 2: UI 交互增强 (`content.js` & `styles.css`)
1.  **右键菜单**: 为 `.nlm-folder-item` 绑定 `contextmenu` 事件。
2.  **自定义菜单 UI**: 创建一个轻量级的右键菜单 DOM，包含“删除”按钮。
3.  **删除逻辑**: 实现 `deleteFolder` 函数，处理数据清理和界面刷新。

### Phase 3: 验证与发布
1.  验证在不同笔记本间切换，数据互不干扰。
2.  验证删除文件夹后，文件归属关系被正确清理。
3.  更新版本号至 `v2.1.21`。

**准备好后，请批准计划，我将开始代码修改。**